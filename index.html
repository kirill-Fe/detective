<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Детектив: Тайна особняка Блэквуда</title>
    <link rel="shortcut icon" href="https://vki7.okcdn.ru/i?r=CICaQJv1RQZIqEhgaodSLR1KLtxTOn52Q4RHLL7Vm3JVBGZbP3leH0RC5qO3gdzrmxuIHSJekcCfq2q6Wou6tMyrsUbZmdCaNbGhOrd_ehQqSoL-kCi5R9bXIN43r7qpJs4cUsS2seUyucPvclnSMa_tJWrI_5wHZ6_IOE4EGRzbjuzjTh_BQso7CQEXZv_JQcg-W5H3Yc-dwHL7AAAAKQ" type="image/x-icon">
    <style>
        /* Курсор для input полей */
        input, textarea {
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="%2363f2c8" d="M12 1c4.97 0 9 3.59 9 8 0 2.38-.93 4.51-2.42 5.96l1.42 1.42C20.04 15.14 21 12.74 21 10c0-5.52-4.48-10-10-10S1 4.48 1 10s4.48 10 10 10c1.27 0 2.47-.24 3.57-.66l1.43 1.43C14.61 21.27 13.35 21.5 12 21.5c-6.33 0-11.5-5.17-11.5-11.5S5.67.5 12 .5zM9.5 7.5h2v2h-2zm0 3h2v2h-2zm3 0h2v2h-2zm-3 3h2v2h-2zm3 0h2v2h-2z"/></svg>'), 
              text;
        }

        /* Стили для выделения текста */
        ::selection {
            background: var(--primary);
            color: var(--lighter);
            text-shadow: none;
        }

        /* Для Firefox */
        ::-moz-selection {
            background: var(--primary);
            color: var(--lighter);
            text-shadow: none;
        }

        /* Стиль курсора */
        html {
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="%238a63f2" d="M3 3l18 18-6-6V11L7 6v11z"/></svg>'), 
                auto;
        }

        /* Изменение курсора при наведении на ссылки и кнопки */
        a, button, .project-link, .choice-btn, .npc-btn, .item {
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="%23ff7e5f" d="M3 3l18 18-6-6V11L7 6v11z"/></svg>'), 
                pointer;
        }

        :root {
            --primary: #8a63f2;
            --secondary: #63f2c8;
            --dark: #121212;
            --darker: #0a0a0a;
            --light: #e0e0e0;
            --lighter: #ffffff;
            --accent: #ff7e5f;
            --card-bg: #1e1e1e;
            --text: #e0e0e0;
            --text-secondary: #a0a0a0;
        }
        /* осн. стили сайта */
        body {
            font-family: 'Courier New', monospace;
            background-color: #121212;
            color: #e0e0e0;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        .game-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        #story-screen {
            background-color: #1e1e1e;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0,0,0,0.7);
        }

        #location-name {
            color: #8a63f2;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
        }

        #story-text {
            min-height: 150px;
            margin: 20px 0;
            white-space: pre-line;
        }

        .choices-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .choice-btn {
            background-color: #2a2a2a;
            color: #f0f0f0;
            border: 1px solid #444;
            padding: 12px;
            transition: all 0.3s;
            text-align: left;
            border-radius: 4px;
        }

        .choice-btn:hover {
            background-color: #3a3a3a;
            border-color: #8a63f2;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .panel {
            background-color: #1e1e1e;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0,0,0,0.7);
        }

        .panel h2 {
            color: #63f2c8;
            margin-top: 0;
            border-bottom: 1px solid #333;
            padding-bottom: 8px;
        }

        #inventory-items, #npc-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .item, .npc-btn {
            background-color: #2a2a2a;
            padding: 10px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .item:hover, .npc-btn:hover {
            background-color: #3a3a3a;
        }

        .item.clue {
            border-left: 3px solid #8a63f2;
        }

        .item.key-item {
            border-left: 3px solid #ff7e5f;
        }

        #dialogue-window {
            margin-top: 15px;
            padding: 15px;
            background-color: #252525;
            border-radius: 6px;
            display: none;
        }

        #dialogue-text {
            margin-bottom: 15px;
            font-style: italic;
        }

        .dialogue-choices {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .progress-tracker {
            margin-top: 20px;
            padding: 10px;
            background-color: #252525;
            border-radius: 6px;
        }

        .progress-item {
            margin: 5px 0;
            padding-left: 15px;
            position: relative;
        }

        .progress-item.completed::before {
            content: "✓";
            color: #63f2c8;
            position: absolute;
            left: 0;
        }

        #hint-button {
            background-color: #333;
            color: #aaa;
            border: none;
            padding: 8px 12px;
            margin-top: 10px;
            border-radius: 4px;
        }

        #hint-button:hover {
            background-color: #444;
        }

        .projects-link-container {
            max-width: 1200px;
            margin: 0 auto 20px;
            padding: 0 20px;
        }

    .projects-link {
        display: inline-block;
        padding: 10px 20px;
        background-color: var(--darker);
        color: var(--secondary);
        text-decoration: none;
        border-radius: 30px;
        border: 2px solid var(--primary);
        font-weight: bold;
        transition: all 0.3s ease;
        transform: translateY(0);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .projects-link:hover {
        background-color: var(--primary);
        color: var(--lighter);
        transform: translateY(-3px);
        box-shadow: 0 6px 12px rgba(138, 99, 242, 0.3);
        border-color: var(--secondary);
    }

    .projects-link:active {
        transform: translateY(1px);
    }

        /* Адаптивные стили для мобильных устройств */
        @media (max-width: 768px) {
        .game-container {
            grid-template-columns: 1fr;
            grid-template-rows: auto auto auto;
            padding: 10px;
        }

        #story-screen, .panel {
            padding: 15px;
        }

        .choices-container, #inventory-items, #npc-list {
            gap: 8px;
        }

        .choice-btn, .item, .npc-btn {
            padding: 10px;
            font-size: 14px;
        }

        #location-name {
            font-size: 1.5rem;
        }

        #story-text {
            min-height: 100px;
            font-size: 14px;
        }

        .sidebar {
            grid-row: 2 / span 2;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .panel {
            margin-bottom: 0;
        }

        #dialogue-window {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            margin: 0;
            border-radius: 0;
            z-index: 100;
            overflow-y: auto;
        }

        #dialogue-choices .choice-btn {
            font-size: 14px;
        }

        .progress-tracker {
            font-size: 14px;
        }
}

    @media (max-width: 480px) {
        .sidebar {
            grid-template-columns: 1fr;
        }

        .choice-btn {
            padding: 8px 10px;
        }

        #location-name {
            font-size: 1.3rem;
        }

        .projects-link {
        padding: 8px 16px;
        font-size: 14px;
        display: block;
        text-align: center;
        margin: 0 auto;
        width: fit-content;
    }
}
    </style>
</head>
<body>
    <div class="projects-link-container">
        <a href="https://kirill-fe.github.io/projects/" class="projects-link" target="_blank">
            projects
        </a>
    </div>

    <div class="game-container">
        <div id="story-screen">
            <h1 id="location-name">Парадный вход</h1>
            <div id="story-text">Вы стоите перед массивными дубовыми дверями особняка Блэквуда. Ветер шевелит опавшие листья, а луна освещает фасад, придавая ему зловещий вид. Скрип дверей нарушает тишину, когда вы входите внутрь.</div>
            <div id="choices" class="choices-container"><button class="choice-btn">Осмотреть прихожую</button><button class="choice-btn">Поговорить с дворецким</button><button class="choice-btn">В ящике вы находите старую газету с заголовком: 'Финансовые проблемы семьи Блэквуд?'</button></div>
            
            <div class="progress-tracker">
                <h3>Ход расследования:</h3>
                <div id="progress-items"></div>
                <button id="hint-button">Подсказка</button>
            </div>
        </div>
        
        <div class="sidebar">
            <div class="panel">
                <h2>Инвентарь</h2>
                <div id="inventory-items"></div>
            </div>
            
            <div class="panel">
                <h2>Персонажи</h2>
                <div id="npc-list"><div class="npc-btn"><strong>Дворецкий Генри</strong><br><small>Пожилой мужчина в безупречном костюме. Руки слегка дрожат.</small></div></div>
                <div id="dialogue-window">
                    <h3 id="dialogue-npc-name"></h3>
                    <div id="dialogue-text"></div>
                    <div id="dialogue-choices" class="dialogue-choices"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // === Игровое состояние ===
        const gameState = {
            location: "mansion_entrance",
            inventory: [],
            clues: [],
            progress: [],
            knownNPCs: ["butler"], // Дворецкий известен с самого начала
            gamePhase: 1,
            flags: {
                hasSpokenToButler: false,
                hasFoundNewspaper: false,
                hasFoundLetter: false,
                hasCheckedPortrait: false,
                hasHouseKey: false,
                hasEnteredLibrary: false,
                hasQuestionedMaid: false,
                hasUnlockedStudy: false,
                hasExaminedWill: false,
                hasConfrontedButler: false,
                caseSolved: false
            },
            currentSuspects: [
                { id: "butler", name: "Дворецкий Генри", motive: "Финансовые проблемы", evidence: [] },
                { id: "maid", name: "Горничная Марта", motive: "Неизвестно", evidence: [] }
            ]
        };

        // === База данных NPC ===
        const npcDatabase = {
            butler: {
                name: "Дворецкий Генри",
                description: "Пожилой мужчина в безупречном костюме. Руки слегка дрожат.",
                dialogues: {
                    initial: {
                        text: "Добрый вечер, сэр. Вы приехали по поводу... инцидента?",
                        options: [
                            { text: "Расскажите, что произошло вчера вечером", next: "crime_info", condition: () => true },
                            { text: "Кто еще находился в доме вчера?", next: "witnesses", condition: () => true },
                            { text: "Мне нужно осмотреть дом", next: "end", condition: () => true }
                        ]
                    },
                    crime_info: {
                        text: "Хозяин был найден в библиотеке около полуночи... Это ужасная трагедия. Он сидел в своем кресле, а на столе перед ним... простите, мне тяжело об этом говорить.",
                        options: [
                            { text: "Что было на столе?", next: "crime_details", condition: () => true },
                            { text: "Вы слышали какие-то звуки?", next: "sounds", condition: () => true },
                            { text: "Спасибо, это все", next: "end", condition: () => true }
                        ]
                    },
                    crime_details: {
                        text: "Раскрытая книга и... письмо. Но я не читал его содержимого, клянусь!",
                        options: [
                            { text: "Где сейчас это письмо?", next: "letter_location", condition: () => true },
                            { text: "Кто мог написать это письмо?", next: "letter_suspect", condition: () => true },
                            { text: "Вы знали о финансовых проблемах хозяина?", next: "financial_troubles",
                                condition: () => gameState.flags.hasFoundNewspaper }
                        ]
                    },
                    letter_location: {
                        text: "Насколько я знаю, оно все еще в библиотеке. Полиция забрала только... тело.",
                        options: [
                            { text: "Спасибо за информацию", next: "end", condition: () => true }
                        ]
                    },
                    financial_troubles: {
                        text: "Я... возможно, были некоторые трудности. Но это не имеет отношения к произошедшему!",
                        options: [
                            { text: "Почему вы скрывали эту информацию?", next: "confront", condition: () => true }
                        ]
                    },
                    confront: {
                        text: "Я не скрывал! Просто... (Генри нервно поправляет галстук) Это личные дела семьи.",
                        options: [
                            { text: "Вы получали деньги от хозяина?", next: "final_confront",
                                condition: () => gameState.flags.hasExaminedWill },
                            { text: "Я вернусь к вам позже", next: "end", condition: () => true }
                        ]
                    },
                    final_confront: {
                        text: "Это... это было завещание! Я не убивал его!",
                        options: [
                            { text: "Вы лжёте! У вас был мотив и возможность", next: "accuse", condition: () => true },
                            { text: "Мне нужно проверить другие версии", next: "end", condition: () => true }
                        ]
                    },
                    accuse: {
                        text: "Вы не можете этого доказать! ...Хотя... (Генри опускает голову) Да, я брал деньги. Но я не убийца!",
                        options: [
                            { text: "[Арестовать дворецкого]", next: "solve_case", condition: () => true }
                        ]
                    },
                    solve_case: {
                        text: "Хорошо... Я признаю. Мы поссорились из-за денег, я толкнул его... Он упал, ударился головой... Я не хотел!",
                        options: [
                            { text: "Дело закрыто", next: "game_over", condition: () => true }
                        ]
                    },
                    game_over: {
                        text: "Дело закрыто. Вы арестовали дворецкого, Генри, за убийство сэра Ричарда Блэквуда. Мотив - финансовые трудности. Вы успешно раскрыли тайну особняка Блэквуда.",
                        options: [] // Нет вариантов, игра окончена
                    },
                    end: {
                        text: "",
                        options: [] // Нет вариантов, диалог завершен
                    }
                }
            },
            maid: {
                name: "Горничная Марта",
                description: "Молодая женщина с красными от слез глазами. Постоянно теребит платок.",
                dialogues: {
                    initial: {
                        text: "Ох, это ужасно... Я до сих пор не могу поверить...",
                        options: [
                            { text: "Когда вы в последний раз видели хозяина?", next: "last_seen", condition: () => true },
                            { text: "Вы заметили что-то подозрительное в последние дни?", next: "suspicious",
                                condition: () => gameState.flags.hasSpokenToButler },
                            { text: "Извините за беспокойство", next: "end", condition: () => true }
                        ]
                    },
                    suspicious: {
                        text: "Пару дней назад я видела, как дворецкий Генри спорил с хозяином... Они говорили о каких-то деньгах. Но я не подслушивала!",
                        options: [
                            { text: "Вы сказали об этом полиции?", next: "police_info", condition: () => true },
                            { text: "Спасибо, это важно", next: "end", condition: () => true }
                        ]
                    },
                    end: {
                        text: "",
                        options: [] // Нет вариантов, диалог завершен
                    }
                }
            }
        };

        // === База данных локаций ===
        const locations = {
            mansion_entrance: {
                name: "Парадный вход",
                description: "Вы стоите перед массивными дубовыми дверями особняка Блэквуда. Ветер шевелит опавшие листья, а луна освещает фасад, придавая ему зловещий вид. Скрип дверей нарушает тишину, когда вы входите внутрь.",
                choices: [
                    {
                        text: "Осмотреть почтовый ящик",
                        action: "search",
                        item: "Старая газета",
                        successText: "В ящике вы находите старую газету с заголовком: 'Финансовые проблемы семьи Блэквуд?'", // Текст при успехе
                        condition: () => !gameState.flags.hasFoundNewspaper
                    },
                    {
                        text: "Поговорить с дворецким",
                        action: "talk",
                        npc: "butler",
                        condition: () => true
                    },
                    {
                        text: "Осмотреть прихожую",
                        action: "move",
                        target: "hallway",
                        condition: () => gameState.flags.hasSpokenToButler
                    }
                ]
            },
            hallway: {
                name: "Главный холл",
                description: "Просторный холл с мраморным полом и высокими потолками. На стене висит портрет покойного хозяина дома.",
                choices: [
                    {
                        text: "Осмотреть портрет",
                        action: "clue",
                        item: "scratched_portrait",
                        successText: "Свежая царапина на портрете... Кто-то явно пытался его повредить.",
                        condition: () => !gameState.flags.hasCheckedPortrait
                    },
                    {
                        text: "Проверить тумбу у лестницы",
                        action: "search",
                        item: "house_key",
                        successText: "В ящике лежит маленький ключ с биркой 'Кабинет'.",
                        condition: () => gameState.flags.hasSpokenToButler && !gameState.flags.hasHouseKey
                    },
                    {
                        text: "Подняться на второй этаж",
                        action: "move",
                        target: "second_floor",
                        condition: () => true
                    },
                    {
                        text: "Вернуться к входу",
                        action: "move",
                        target: "mansion_entrance",
                        condition: () => true
                    }
                ]
            },
            second_floor: {
                name: "Второй этаж",
                description: "Длинный коридор с несколькими дверями. Одна из них ведет в библиотеку.",
                choices: [
                    {
                        text: "Зайти в библиотеку",
                        action: "move",
                        target: "library",
                        condition: () => true
                    },
                    {
                        text: "Открыть кабинет (нужен ключ)",
                        action: "useItem",
                        item: "house_key",
                        target: "study",
                        successText: "Вы использовали ключ и вошли в кабинет.",
                        condition: () => gameState.flags.hasHouseKey && !gameState.flags.hasUnlockedStudy
                    },
                    {
                        text: "Вернуться в холл",
                        action: "move",
                        target: "hallway",
                        condition: () => true
                    }
                ]
            },
            library: {
                name: "Библиотека",
                description: "Здесь было найдено тело. На столе лежит раскрытая книга и... письмо?",
                choices: [
                    {
                        text: "Осмотреть стол",
                        action: "clue",
                        item: "letter",
                        successText: "Письмо содержит угрозы: 'Если долг не будет возвращен, последствия будут ужасны...' Подпись: 'Г.Х.'",
                        condition: () => !gameState.flags.hasFoundLetter
                    },
                    {
                        text: "Проверить книжные полки",
                        action: "search",
                        item: "account_book",
                        successText: "Бухгалтерская книга показывает крупные выплаты некому 'Г.Х.'",
                        condition: () => !gameState.inventory.includes("account_book")
                    },
                    {
                        text: "Выйти из библиотеки",
                        action: "move",
                        target: "second_floor",
                        condition: () => true
                    }
                ]
            },
            study: {
                name: "Кабинет",
                description: "Кабинет хозяина. На столе — документы и черновик завещания...",
                choices: [
                    {
                        text: "Осмотреть стол",
                        action: "clue",
                        item: "will_draft",
                        successText: "Черновик завещания: основное состояние должно перейти... дворецкому Генри?! Дата - день перед убийством.",
                        condition: () => !gameState.clues.includes("will_draft")
                    },
                    {
                        text: "Вернуться в коридор",
                        action: "move",
                        target: "second_floor",
                        condition: () => true
                    }
                ]
            }
        };

        // === Функции рендеринга ===
        function renderNPCs() {
            const npcList = document.getElementById('npc-list');
            npcList.innerHTML = '';
            gameState.knownNPCs.forEach(npcId => {
                const npc = npcDatabase[npcId];
                const button = document.createElement('div');
                button.className = 'npc-btn';
                button.innerHTML = `<strong>${npc.name}</strong><br><small>${npc.description}</small>`;
                button.addEventListener('click', () => startDialogue(npcId));
                npcList.appendChild(button);
            });
        }

        function renderInventory() {
            const inventoryItems = document.getElementById('inventory-items');
            inventoryItems.innerHTML = '';
            gameState.inventory.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'item';
                itemDiv.textContent = item;
                if (gameState.clues.includes(item)) {
                    itemDiv.classList.add('clue');
                }
                if (item === 'house_key') {
                    itemDiv.classList.add('key-item');
                }
                inventoryItems.appendChild(itemDiv);
            });
        }

        function updateProgressTracker() {
            const progressItems = document.getElementById('progress-items');
            progressItems.innerHTML = '';
            gameState.progress.forEach(item => {
                const progressItem = document.createElement('div');
                progressItem.className = 'progress-item';
                progressItem.textContent = item;
                progressItems.appendChild(progressItem);
            });
        }

        // === Функции диалога ===
        function startDialogue(npcId) {
            const npc = npcDatabase[npcId];
            showDialogue(npcId, npc.dialogues.initial);
        }

        function showDialogue(npcId, dialogue) {
            const dialogueWindow = document.getElementById('dialogue-window');
            const dialogueText = document.getElementById('dialogue-text');
            const dialogueChoices = document.getElementById('dialogue-choices');
            const dialogueNpcName = document.getElementById('dialogue-npc-name');

            dialogueNpcName.textContent = npcDatabase[npcId].name;
            dialogueText.textContent = dialogue.text;
            dialogueChoices.innerHTML = '';

            dialogue.options.forEach(option => {
                if (!option.condition || option.condition()) {
                    const button = document.createElement('button');
                    button.className = 'choice-btn';
                    button.textContent = option.text;
                    button.addEventListener('click', () => {
                        if (option.next === 'end') {
                            dialogueWindow.style.display = 'none';
                        } else if (option.next === 'game_over') {
                            showDialogue(npcId, npcDatabase[npcId].dialogues[option.next]);
                            const choiceButtons = dialogueChoices.querySelectorAll('.choice-btn');
                                choiceButtons.forEach(btn => {
                                    btn.disabled = true;
                                    btn.style.opacity = "0.6";
                                });
                        }
                        else {
                            showDialogue(npcId, npcDatabase[npcId].dialogues[option.next]);
                        }
                    });
                    dialogueChoices.appendChild(button);
                }
            });

            dialogueWindow.style.display = 'block';
        }

        // === Функции игрового процесса ===
        function updateGame() {
            const location = locations[gameState.location];
            document.getElementById('location-name').textContent = location.name;

            // Добавляем начальное описание только при первом входе
            let storyText = location.description;
            if (!gameState.progress.length) {
                storyText = "Вы - частный детектив, вызванный расследовать загадочную смерть сэра Ричарда Блэквуда в его собственном особняке.\n\n" + storyText;
            }

            document.getElementById('story-text').textContent = storyText;

            const choicesContainer = document.getElementById('choices');
            choicesContainer.innerHTML = '';

            location.choices.forEach(choice => {
                if (!choice.condition || choice.condition()) {
                    const button = document.createElement('button');
                    button.className = 'choice-btn';
                    button.textContent = choice.text;
                    button.addEventListener('click', () => handleChoice(choice));
                    choicesContainer.appendChild(button);
                } else {
                    // Показываем серую неактивную кнопку с подсказкой
                    const disabledButton = document.createElement('button');
                    disabledButton.className = 'choice-btn';
                    disabledButton.textContent = choice.text;
                    disabledButton.disabled = true;
                    disabledButton.style.opacity = "0.6";
                    disabledButton.title = "Сначала нужно выполнить другие действия";
                    choicesContainer.appendChild(disabledButton);
                }
            });
        }

        function handleChoice(choice) {
            let text = document.getElementById('story-text').textContent + "\n\n";
            switch (choice.action) {
                case 'move':
                    gameState.location = choice.target;
                    addProgress(`Переместился в ${locations[choice.target].name}`);
                    if (choice.target === "library") gameState.flags.hasEnteredLibrary = true;
                    break;

                case 'talk':
                    if (choice.npc === 'butler') gameState.flags.hasSpokenToButler = true;
                    startDialogue(choice.npc);
                    addProgress(`Поговорил с ${npcDatabase[choice.npc].name}`);
                    return; // Важно: диалог запускается отдельно

                case 'clue':
                    if (!gameState.clues.includes(choice.item)) {
                        gameState.clues.push(choice.item);
                        text += choice.successText;
                        document.getElementById('story-text').textContent = text;

                        // Обновляем флаги
                        if (choice.item === 'letter') {
                            gameState.flags.hasFoundLetter = true;
                            gameState.currentSuspects[0].evidence.push("Угрожающее письмо от Г.Х.");
                        }
                        if (choice.item === 'scratched_portrait') {
                            gameState.flags.hasCheckedPortrait = true;
                            gameState.currentSuspects[0].evidence.push("Следы борьбы у портрета");
                        }
                        if (choice.item === 'will_draft') {
                            gameState.flags.hasExaminedWill = true;
                            gameState.currentSuspects[0].evidence.push("Завещание в пользу дворецкого");
                        }

                        addProgress(`Нашел улику: ${choice.item}`);
                    }
                    break;

                case 'search':
                    if (!gameState.inventory.includes(choice.item)) {
                        gameState.inventory.push(choice.item);
                        text += choice.successText;
                        document.getElementById('story-text').textContent = text;

                        if (choice.item === 'old_newspaper') {
                            gameState.flags.hasFoundNewspaper = true;
                            gameState.currentSuspects[0].evidence.push("Финансовые проблемы");
                        }
                        if (choice.item === 'house_key') {
                            gameState.flags.hasHouseKey = true;
                        }
                        if (choice.item === 'account_book') {
                            gameState.currentSuspects[0].evidence.push("Бухгалтерские записи о выплатах Г.Х.");
                        }

                        addProgress(`Нашел предмет: ${choice.item}`);
                    }
                    break;

                case 'useItem':
                    if (gameState.inventory.includes(choice.item)) {
                        gameState.location = choice.target;
                        text += choice.successText;
                        document.getElementById('story-text').textContent = text;

                        if (choice.target === 'study') gameState.flags.hasUnlockedStudy = true;
                        addProgress(`Использовал ${choice.item} для доступа в ${locations[choice.target].name}`);
                    }
                    break;
            }

            updateGame();
            renderInventory();
            checkCaseSolution();
        }

        // Функция добавления записи в журнал прогресса
        function addProgress(text) {
            gameState.progress.push(text);
            updateProgressTracker();
        }

        // Проверка решения дела
        function checkCaseSolution() {
            if (gameState.flags.hasConfrontedButler &&
                gameState.clues.includes("letter") &&
                gameState.clues.includes("will_draft") &&
                !gameState.flags.caseSolved) {

                gameState.flags.caseSolved = true;
                document.getElementById('story-text').textContent +=
                    "\n\nВы собрали все доказательства против дворецкого Генри. " +
                    "Теперь можно предъявить обвинение!";
            }
        }

        // Улучшенные подсказки
        function giveHint() {
            let hint = "";

            if (!gameState.flags.hasSpokenToButler) {
                hint = "Дворецкий - ваш первый контакт. Поговорите с ним, чтобы узнать об обстоятельствах смерти.";
            } else if (!gameState.flags.hasFoundNewspaper) {
                hint = "Осмотрите почтовый ящик у входа. Там может быть что-то интересное.";
            } else if (!gameState.flags.hasEnteredLibrary) {
                hint = "Библиотека - место преступления. Необходимо ее осмотреть.";
            } else if (!gameState.flags.hasFoundLetter) {
                hint = "В библиотеке осмотрите стол. Возможно, вы найдете там письмо с важной информацией.";
            } else if (!gameState.flags.hasHouseKey) {
                hint = "В холле есть тумба у лестницы. Проверьте ее на наличие полезных предметов.";
            } else if (!gameState.flags.hasUnlockedStudy) {
                hint = "Вы нашли ключ. Попробуйте использовать его на двери кабинета на втором этаже.";
            } else if (!gameState.flags.hasExaminedWill) {
                hint = "В кабинете осмотрите стол. Там может быть черновик завещания.";
            } else if (!gameState.flags.hasConfrontedButler) {
                hint = "У вас достаточно улик против дворецкого. Возможно, стоит поговорить с ним еще раз и предъявить ему свои обвинения.";
            } else if (gameState.flags.caseSolved) {
                hint = "Вы собрали все необходимые улики и обвинили дворецкого. Дело закрыто.";
            } else {
                hint = "Кажется, вы все сделали! Может быть, пропустили что-то очевидное?";
            }

            document.getElementById('story-text').textContent += `\n\n[Подсказка: ${hint}]`;
        }

        // === Инициализация ===
        document.addEventListener('DOMContentLoaded', () => {
            updateGame();
            renderNPCs();
            renderInventory();
            updateProgressTracker();
            document.getElementById('hint-button').addEventListener('click', giveHint);
        });
    </script>
</body>
</html>
